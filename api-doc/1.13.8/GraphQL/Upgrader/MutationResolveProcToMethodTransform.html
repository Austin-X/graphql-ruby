<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  Class: GraphQL::Upgrader::MutationResolveProcToMethodTransform
  
    &mdash; GraphQL Ruby API Documentation
  
</title>

  <link rel="stylesheet" href="../../css/style.css" type="text/css" />

  <link rel="stylesheet" href="../../css/common.css" type="text/css" />

<script type="text/javascript">
  pathId = "GraphQL::Upgrader::MutationResolveProcToMethodTransform";
  relpath = '../../';
</script>


  <script type="text/javascript" charset="utf-8" src="../../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../../js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="../../class_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="../../_index.html">Index (M)</a> &raquo;
    <span class='title'><span class='object_link'><a href="../../GraphQL.html" title="GraphQL (module)">GraphQL</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../Upgrader.html" title="GraphQL::Upgrader (module)">Upgrader</a></span></span>
     &raquo; 
    <span class="title">MutationResolveProcToMethodTransform</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="../../class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><h1>Class: GraphQL::Upgrader::MutationResolveProcToMethodTransform
  
  
  
</h1>
<div class="box_info">
  
  <dl>
    <dt>Inherits:</dt>
    <dd>
      <span class="inheritName"><span class='object_link'><a href="Transform.html" title="GraphQL::Upgrader::Transform (class)">Transform</a></span></span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next"><span class='object_link'><a href="Transform.html" title="GraphQL::Upgrader::Transform (class)">Transform</a></span></li>
          
            <li class="next">GraphQL::Upgrader::MutationResolveProcToMethodTransform</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
    </dd>
  </dl>
  

  
  
  
  
  

  

  
  <dl>
    <dt>Defined in:</dt>
    <dd>lib/graphql/upgrader/member.rb</dd>
  </dl>
  
</div>








  
    <h2>
      Instance Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#apply-instance_method" title="#apply (instance method)">#<strong>apply</strong>(input_text)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>TODO dedup with ResolveProcToMethodTransform.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#initialize-instance_method" title="#initialize (instance method)">#<strong>initialize</strong>(proc_name: &quot;resolve&quot;)  &#x21d2; MutationResolveProcToMethodTransform </a>
    

    
  </span>
  
  
    <span class="note title constructor">constructor</span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>A new instance of MutationResolveProcToMethodTransform.</p>
</div></span>
  
</li>

      
    </ul>
  


  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods inherited from <span class='object_link'><a href="Transform.html" title="GraphQL::Upgrader::Transform (class)">Transform</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="Transform.html#apply_processor-instance_method" title="GraphQL::Upgrader::Transform#apply_processor (method)">#apply_processor</a></span>, <span class='object_link'><a href="Transform.html#normalize_type_expression-instance_method" title="GraphQL::Upgrader::Transform#normalize_type_expression (method)">#normalize_type_expression</a></span>, <span class='object_link'><a href="Transform.html#reindent_lines-instance_method" title="GraphQL::Upgrader::Transform#reindent_lines (method)">#reindent_lines</a></span>, <span class='object_link'><a href="Transform.html#trim_lines-instance_method" title="GraphQL::Upgrader::Transform#trim_lines (method)">#trim_lines</a></span>, <span class='object_link'><a href="Transform.html#underscorize-instance_method" title="GraphQL::Upgrader::Transform#underscorize (method)">#underscorize</a></span></p>
<div id="constructor_details" class="method_details_list">
  <h2>Constructor Details</h2>
  
    <div class="method_details first">
  <h3 class="signature first" id="initialize-instance_method">
  
    #<strong>initialize</strong>(proc_name: &quot;resolve&quot;)  &#x21d2; <tt><span class='object_link'><a href="" title="GraphQL::Upgrader::MutationResolveProcToMethodTransform (class)">MutationResolveProcToMethodTransform</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Returns a new instance of MutationResolveProcToMethodTransform.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>proc_name</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>&quot;resolve&quot;</tt>)</em>
      
      
        &mdash;
        <div class='inline'><p>The name of the proc to be moved to <code>def self.#{proc_name}</code></p>
</div>
      
    </li>
  
</ul>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


364
365
366</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/graphql/upgrader/member.rb', line 364</span>

<span class='kw'>def</span> <span class='id identifier rubyid_initialize'>initialize</span><span class='lparen'>(</span><span class='label'>proc_name:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>resolve</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
  <span class='ivar'>@proc_name</span> <span class='op'>=</span> <span class='id identifier rubyid_proc_name'>proc_name</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
  
</div>


  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="apply-instance_method">
  
    #<strong>apply</strong>(input_text)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>TODO dedup with ResolveProcToMethodTransform</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


369
370
371
372
373
374
375
376
377
378
379
380
381
382
383
384
385
386
387
388
389
390
391
392
393
394
395
396
397
398
399
400
401
402
403</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/graphql/upgrader/member.rb', line 369</span>

<span class='kw'>def</span> <span class='id identifier rubyid_apply'>apply</span><span class='lparen'>(</span><span class='id identifier rubyid_input_text'>input_text</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_input_text'>input_text</span> <span class='op'>=~</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>GraphQL::Relay::Mutation\.define</span><span class='regexp_end'>/</span></span>
    <span class='id identifier rubyid_named_proc_processor'>named_proc_processor</span> <span class='op'>=</span> <span class='id identifier rubyid_apply_processor'>apply_processor</span><span class='lparen'>(</span><span class='id identifier rubyid_input_text'>input_text</span><span class='comma'>,</span> <span class='const'><span class='object_link'><a href="ProcToClassMethodTransform.html" title="GraphQL::Upgrader::ProcToClassMethodTransform (class)">ProcToClassMethodTransform</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="ProcToClassMethodTransform/NamedProcProcessor.html" title="GraphQL::Upgrader::ProcToClassMethodTransform::NamedProcProcessor (class)">NamedProcProcessor</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="ProcToClassMethodTransform/NamedProcProcessor.html#initialize-instance_method" title="GraphQL::Upgrader::ProcToClassMethodTransform::NamedProcProcessor#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='ivar'>@proc_name</span><span class='rparen'>)</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_resolve_proc_processor'>resolve_proc_processor</span> <span class='op'>=</span> <span class='id identifier rubyid_apply_processor'>apply_processor</span><span class='lparen'>(</span><span class='id identifier rubyid_input_text'>input_text</span><span class='comma'>,</span> <span class='const'><span class='object_link'><a href="ResolveProcToMethodTransform.html" title="GraphQL::Upgrader::ResolveProcToMethodTransform (class)">ResolveProcToMethodTransform</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="ResolveProcToMethodTransform/ResolveProcProcessor.html" title="GraphQL::Upgrader::ResolveProcToMethodTransform::ResolveProcProcessor (class)">ResolveProcProcessor</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="ResolveProcToMethodTransform/ResolveProcProcessor.html#initialize-instance_method" title="GraphQL::Upgrader::ResolveProcToMethodTransform::ResolveProcProcessor#initialize (method)">new</a></span></span><span class='rparen'>)</span>

    <span class='id identifier rubyid_named_proc_processor'>named_proc_processor</span><span class='period'>.</span><span class='id identifier rubyid_proc_to_method_sections'>proc_to_method_sections</span><span class='period'>.</span><span class='id identifier rubyid_zip'>zip</span><span class='lparen'>(</span><span class='id identifier rubyid_resolve_proc_processor'>resolve_proc_processor</span><span class='period'>.</span><span class='id identifier rubyid_resolve_proc_sections'>resolve_proc_sections</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_reverse'>reverse</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_pair'>pair</span><span class='op'>|</span>
      <span class='id identifier rubyid_proc_to_method_section'>proc_to_method_section</span><span class='comma'>,</span> <span class='id identifier rubyid_resolve_proc_section'>resolve_proc_section</span> <span class='op'>=</span> <span class='op'>*</span><span class='id identifier rubyid_pair'>pair</span>
      <span class='id identifier rubyid_proc_body'>proc_body</span> <span class='op'>=</span> <span class='id identifier rubyid_input_text'>input_text</span><span class='lbracket'>[</span><span class='id identifier rubyid_proc_to_method_section'>proc_to_method_section</span><span class='period'>.</span><span class='id identifier rubyid_proc_body_start'>proc_body_start</span><span class='op'>..</span><span class='id identifier rubyid_proc_to_method_section'>proc_to_method_section</span><span class='period'>.</span><span class='id identifier rubyid_proc_body_end'>proc_body_end</span><span class='rbracket'>]</span>
      <span class='id identifier rubyid_method_defn_indent'>method_defn_indent</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'> </span><span class='tstring_end'>&quot;</span></span> <span class='op'>*</span> <span class='id identifier rubyid_proc_to_method_section'>proc_to_method_section</span><span class='period'>.</span><span class='id identifier rubyid_proc_defn_indent'>proc_defn_indent</span>

      <span class='id identifier rubyid_obj_arg_name'>obj_arg_name</span><span class='comma'>,</span> <span class='id identifier rubyid_args_arg_name'>args_arg_name</span><span class='comma'>,</span> <span class='id identifier rubyid_ctx_arg_name'>ctx_arg_name</span> <span class='op'>=</span> <span class='id identifier rubyid_resolve_proc_section'>resolve_proc_section</span><span class='period'>.</span><span class='id identifier rubyid_proc_arg_names'>proc_arg_names</span>
      <span class='comment'># This is not good, it will hit false positives
</span>      <span class='comment'># Should use AST to make this substitution
</span>      <span class='kw'>if</span> <span class='id identifier rubyid_obj_arg_name'>obj_arg_name</span> <span class='op'>!=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>_</span><span class='tstring_end'>&quot;</span></span>
        <span class='id identifier rubyid_proc_body'>proc_body</span><span class='period'>.</span><span class='id identifier rubyid_gsub!'>gsub!</span><span class='lparen'>(</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>([^\w:.]|^)</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_obj_arg_name'>obj_arg_name</span><span class='embexpr_end'>}</span><span class='tstring_content'>([^\w:]|$)</span><span class='regexp_end'>/</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>\1object\2</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
      <span class='kw'>end</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_ctx_arg_name'>ctx_arg_name</span> <span class='op'>!=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>_</span><span class='tstring_end'>&quot;</span></span>
        <span class='id identifier rubyid_proc_body'>proc_body</span><span class='period'>.</span><span class='id identifier rubyid_gsub!'>gsub!</span><span class='lparen'>(</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>([^\w:.]|^)</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_ctx_arg_name'>ctx_arg_name</span><span class='embexpr_end'>}</span><span class='tstring_content'>([^\w:]|$)</span><span class='regexp_end'>/</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>\1context\2</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
      <span class='kw'>end</span>

      <span class='id identifier rubyid_method_defn'>method_defn</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>def </span><span class='embexpr_beg'>#{</span><span class='ivar'>@proc_name</span><span class='embexpr_end'>}</span><span class='tstring_content'>(**</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_args_arg_name'>args_arg_name</span><span class='embexpr_end'>}</span><span class='tstring_content'>)\n</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_method_defn_indent'>method_defn_indent</span><span class='embexpr_end'>}</span><span class='tstring_content'>  </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_proc_body'>proc_body</span><span class='embexpr_end'>}</span><span class='tstring_content'>\n</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_method_defn_indent'>method_defn_indent</span><span class='embexpr_end'>}</span><span class='tstring_content'>end\n</span><span class='tstring_end'>&quot;</span></span>
      <span class='id identifier rubyid_method_defn'>method_defn</span> <span class='op'>=</span> <span class='id identifier rubyid_trim_lines'>trim_lines</span><span class='lparen'>(</span><span class='id identifier rubyid_method_defn'>method_defn</span><span class='rparen'>)</span>
      <span class='comment'># Update usage of args keys
</span>      <span class='id identifier rubyid_method_defn'>method_defn</span> <span class='op'>=</span> <span class='id identifier rubyid_method_defn'>method_defn</span><span class='period'>.</span><span class='id identifier rubyid_gsub'>gsub</span><span class='lparen'>(</span><span class='tstring'><span class='regexp_beg'>/</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_args_arg_name'>args_arg_name</span><span class='embexpr_end'>}</span><span class='tstring_content'>(?&lt;method_begin&gt;\.key\?\(?|\[)[&quot;&#39;:](?&lt;arg_name&gt;[a-zA-Z0-9_]+)[&quot;&#39;]?(?&lt;method_end&gt;\]|\))?</span><span class='regexp_end'>/</span></span><span class='rparen'>)</span> <span class='kw'>do</span>
        <span class='id identifier rubyid_method_begin'>method_begin</span> <span class='op'>=</span> <span class='gvar'>$~</span><span class='lbracket'>[</span><span class='symbol'>:method_begin</span><span class='rbracket'>]</span>
        <span class='id identifier rubyid_arg_name'>arg_name</span> <span class='op'>=</span> <span class='id identifier rubyid_underscorize'>underscorize</span><span class='lparen'>(</span><span class='gvar'>$~</span><span class='lbracket'>[</span><span class='symbol'>:arg_name</span><span class='rbracket'>]</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_method_end'>method_end</span> <span class='op'>=</span> <span class='gvar'>$~</span><span class='lbracket'>[</span><span class='symbol'>:method_end</span><span class='rbracket'>]</span>
        <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_args_arg_name'>args_arg_name</span><span class='embexpr_end'>}</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_method_begin'>method_begin</span><span class='embexpr_end'>}</span><span class='tstring_content'>:</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_arg_name'>arg_name</span><span class='embexpr_end'>}</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_method_end'>method_end</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>end</span>
      <span class='comment'># replace the proc with the new method
</span>      <span class='id identifier rubyid_input_text'>input_text</span><span class='lbracket'>[</span><span class='id identifier rubyid_proc_to_method_section'>proc_to_method_section</span><span class='period'>.</span><span class='id identifier rubyid_proc_defn_start'>proc_defn_start</span><span class='op'>..</span><span class='id identifier rubyid_proc_to_method_section'>proc_to_method_section</span><span class='period'>.</span><span class='id identifier rubyid_proc_defn_end'>proc_defn_end</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_method_defn'>method_defn</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_input_text'>input_text</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

      <div id="footer">
  Generated on Mon Jan 31 16:58:35 2022 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.9.27 (ruby-2.7.5).
</div>

    </div>
  </body>
</html>